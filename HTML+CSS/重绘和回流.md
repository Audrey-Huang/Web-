#### 浏览器渲染机制与步骤

1. 浏览器将获取的html文档解析成DOM树，启用另一个线程下载css，js。将css解析成CSSOM树。
2. 浏览器从DOM树的根节点开始遍历每个可见节点，对每个节点找到适配的CSS样式规则，构建成渲染树。
3. 针对渲染树上的每个节点对象，计算出正确的位置信息，将其渲染到正确的位置上。

注意点：

1. DOM树构建过程中可能会被CSS和JS加载而执行阻塞，display:none的元素会在DOM树中，注释和script标签也会在DOM树中。

2. CSS的解析和DOM解析可以同时进行，CSS解析与script的执行互斥。

3. 渲染树与dom树不一致，渲染树中没有标签。

4. display:none不会显示在渲染树中，脱离文档流了

5. visibility：hidden则会显示在渲染树中。本质上还是opacity:0;

   

#### 阻塞渲染

Q：为什么遇到script标签就会停下对HTML文档的解析？

A：因为JS脚本中可能包含有对DOM或者CSSOM的操作，脚本解会将脚本中改变DOM和CSS的地方解析出来，追加到DOM树和CSSOM规则树上。



#### 回流

当页面布局发生变化，浏览器需要重新计算各个节点的位置信息，浏览器会从root frame递归向下计算，重新回去计算的过程就是回流。回流与DOM树和渲染树有关。

引起回流的行为：页面初始化时；DOM操作时；内容变化时；CSS属性的计算或者改变；添加或删除样式表等。

回流会引重绘，但重绘不一定引起回流。



#### 重绘

只与渲染树有关。

* 更换颜色
* 不影响页面布局的操作

DOM树不发生变化，但颜色变了，渲染树需要重新渲染页面，**这就是重绘**

但如果窗口的大小改变了，则会引起回流。



#### 如何减少回流

1. 增删节点时，利用documentfragment创建完成后一次性加入。
2. 几何属性变化时，最好把多个属性定义在一个类里，这样可以只引起一次回流
3. 元素位置变化：不要更改margin、padding等属性，使用定位脱离文档流后改变位置会更好
4. 获取元素的偏移值：为了保证获取值的正确性，也会回流取得最新的值，所以如果要多次操作，最好取完值做个缓存。
5. 避免使用<table>，一个很小的改动会造成整个table的重新布局
